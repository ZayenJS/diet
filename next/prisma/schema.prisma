// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "debian-openssl-1.1.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Recipe {
  id              Int           @id @default(autoincrement())
  name            String        @db.VarChar(100)
  description     String?       @db.Text
  difficulty      Difficulty
  rating          Int           @db.Integer
  cost            Float         @db.Real
  preparationTime Int           @map("preparation_time")
  cookingTime     Int           @map("cooking_time")
  restTime        Int           @map("rest_time")
  thumbnailUrl    String        @map("thumbnail_url")
  forHowMany      Int           @map("for_how_many")
  calories        Int?          @db.Integer
  protein         Float?        @db.Real
  fat             Float?        @db.Real
  saturated       Float?        @db.Real
  carbs           Float?        @db.Real
  sugar           Float?        @db.Real
  steps           Step[]
  ingredients     Ingredient[]
  images          RecipeImage[]
  tags            Tag[]         @relation("recipes_tags")
  category        Category?     @relation(fields: [categoryId], references: [id], name: "recipes_categories")
  categoryId      Int?          @map("category_id")
  tools           Tool[]        @relation("recipes_tools")
  createdAt       DateTime      @default(now()) @map("created_at")
  updatedAt       DateTime      @updatedAt @map("updated_at")

  @@unique([name], name: "recipe_name_unique")
  @@index([name], name: "recipe_name")
  @@index([difficulty], name: "recipe_difficulty")
  @@index([rating], name: "recipe_rating")
  @@index([calories], name: "macro_calories")
  @@index([protein], name: "macro_protein")
  @@map("recipes")
}

model Tool {
  id        Int      @id @default(autoincrement())
  name      String   @unique @db.VarChar(100)
  recipeId  Int?     @map("recipe_id")
  recipes   Recipe[] @relation("recipes_tools")
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@index([name], name: "tool_name")
  @@map("tools")
}

model Tag {
  id        Int      @id @default(autoincrement())
  name      String   @unique @db.VarChar(30)
  color     String   @default("#fff") @db.VarChar(7)
  recipes   Recipe[] @relation("recipes_tags")
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("tags")
}

model Category {
  id        Int      @id @default(autoincrement())
  name      String   @unique @db.VarChar(30)
  color     String   @default("#fff") @db.VarChar(7)
  recipes   Recipe[] @relation("recipes_categories")
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("categories")
}

model Step {
  id        Int      @id @default(autoincrement())
  text      String   @db.Text
  recipeId  Int?     @map("recipe_id")
  recipe    Recipe?  @relation(fields: [recipeId], references: [id])
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("steps")
}

model Product {
  id          Int          @id @default(autoincrement())
  name        String       @unique @db.VarChar(100)
  images      String?      @db.Text
  ingredients Ingredient[]
  createdAt   DateTime     @default(now()) @map("created_at")
  updatedAt   DateTime     @updatedAt @map("updated_at")

  @@index([name], name: "product_name")
  @@map("products")
}

model Ingredient {
  id        Int      @id @default(autoincrement())
  productId Int      @map("product_id")
  product   Product  @relation(fields: [productId], references: [id])
  recipeId  Int?     @map("recipe_id")
  recipe    Recipe?  @relation(fields: [recipeId], references: [id])
  unit      Unit
  amount    Float    @db.Real
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@index([productId], name: "ingredient_product_id")
  @@index([recipeId], name: "ingredient_recipe_id")
  @@map("ingredients")
}

model RecipeImage {
  id        Int      @id @default(autoincrement())
  url       String   @db.Text
  recipeId  Int?     @map("recipe_id")
  recipe    Recipe?  @relation(fields: [recipeId], references: [id])
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("recipe_images")
}

enum Role {
  ADMIN
  USER

  @@map("roles")
}

enum Difficulty {
  EASY
  MEDIUM
  HARD

  @@map("difficulty")
}

enum Unit {
  GRAM
  KILOGRAM
  LITER
  MILLILITER
  TEASPOON
  TABLESPOON
  CUP
  PINCH
  PIECE

  @@map("unit")
}
